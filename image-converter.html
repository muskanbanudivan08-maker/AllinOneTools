<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Image Converter</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 20px; max-width: 720px; margin:auto; }
    .preview { max-width:100%; margin-top:12px; }
  </style>
</head>
<body>
  <h2>Client-side Image Converter</h2>
  <input id="file" type="file" accept="image/*" />
  <select id="format">
    <option value="image/png">PNG</option>
    <option value="image/jpeg">JPEG</option>
    <option value="image/webp">WEBP</option>
  </select>
  <button id="convert">Convert & Download</button>
  <br/>
  <img id="preview" class="preview" alt="preview"/>
  <script>
    const fileInput = document.getElementById('file');
    const preview = document.getElementById('preview');
    let img = new Image();

    fileInput.addEventListener('change', e => {
      const f = e.target.files[0];
      if (!f) return;
      const url = URL.createObjectURL(f);
      img.onload = () => {
        preview.src = url;
        URL.revokeObjectURL(url);
      };
      img.src = url;
    });

    document.getElementById('convert').addEventListener('click', () => {
      if (!img.src) { alert('Pick a file first'); return; }
      const fmt = document.getElementById('format').value;
      const canvas = document.createElement('canvas');
      canvas.width = img.naturalWidth;
      canvas.height = img.naturalHeight;
      const ctx = canvas.getContext('2d');
      // for JPEG, fill white background to avoid black for transparent PNG
      if (fmt === 'image/jpeg') {
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0,0,canvas.width, canvas.height);
      }
      ctx.drawImage(img, 0, 0);
      canvas.toBlob(blob => {
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'converted.' + fmt.split('/')[1];
        a.click();
        URL.revokeObjectURL(a.href);
      }, fmt, 0.92);
    });
  </script>
</body>
</html>
